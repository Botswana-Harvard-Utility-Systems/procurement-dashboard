{% extends 'edc_base/base.html' %}
{% load static %}

{% block extra-styles %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">

<style>
	.doc-btns div {
		margin-right: 100px
	}
	.p-4 {
    padding: 1.5rem !important;
	}
	.mb-4, .my-4 {
    margin-bottom: 1.5rem !important;
	}
	.mt-4, .my-4 {
	    margin-top: 1.5rem !important;
	}
	.mb-2, .my-2 {
    margin-bottom: .5rem !important;
	}
	.mt-2, .my-2 {
	    margin-top: .5rem !important;
	}
	.card {
	    position: relative;
	    display: -ms-flexbox;
	    display: flex;
	    -ms-flex-direction: column;
	    flex-direction: column;
	    min-width: 0;
	    word-wrap: break-word;
	    background-color: #fff;
	    background-clip: border-box;
	    border: 1px solid rgba(0,0,0,.125);
	    border-radius: .25rem;
	}
	.card h4 {
		font-family: sans-serif;
		font-weight: 500;
	}
	.report {
    width: 190.0mm;
    height: 270.0mm;
	}
	.report {
	    background: white;
	    box-shadow: 0 0 0.2cm rgba(0,0,0,0.2);
	    margin: 0mm auto;
	    padding: 0 !important;
	}
	.report {
	    overflow: hidden;
	    position: relative;
	    box-sizing: border-box;
	    font-family: Tahoma sans-serif;
	    font-size: 9pt;
	}

	.clickable
	{
	    cursor: pointer;
	}
	
	.clickable .glyphicon
	{
	    background: rgba(0, 0, 0, 0.15);
	    display: inline-block;
	    padding: 6px 12px;
	    border-radius: 4px
	}
	
	.panel-heading span
	{
	    margin-top: -23px;
	    margin-right: -9px;
	}

	a.clickable { color: inherit; }
	a.clickable:hover { text-decoration:none; }

	.panel-body { padding:0px; }
	.panel-footer { margin: 0; }
	.panel .glyphicon,.list-group-item .glyphicon { margin-right:5px; }
	.panel-body .radio, .checkbox { display:inline-block;margin:0px; }
	.panel-body input[type=checkbox]:checked + label { text-decoration: line-through;color: rgb(128, 144, 160); }
	.list-group-item:hover, a.list-group-item:focus {text-decoration: none;background-color: rgb(245, 245, 245);}
	.list-group { margin-bottom:0px; padding:5px }

</style>
{% endblock extra-styles %}
{% block extra-scripts %}
	<script type="text/javascript" charset="utf8">
		function formAjaxSubmit(modal, action, cbAfterLoad, cbAfterSuccess) {
			var form = modal.find('.modal-body form');
			var header = $(modal).find('.modal-header');
	
			var btn_save = modal.find('.modal-footer .btn-save');
			if (btn_save) {
				btn_save.off().on('click', function(e) {
					modal.find('.modal-bosy form').submit();
				});
			}
	
			if (cbAfterLoad) { cbAfterLoad(modal); }
			
			modal.find('form input:visible').first().focus();
	
			$(form).on('submit', function(e) {
				e.preventDefault();
	
				var url = $(this).attr('action') || action;
	
				$.ajax({
					type: $(this).attr('method'),
					url: url,
					data: $(this).serialize(),
					success: function(xhr, ajaxOptions, thrownError) {
	
						$(modal).find('.modal-body').html(xhr);
	
						if ($(xhr).find('.has-error').length > 0) {
							formAjaxSubmit(modal, url, cbAfterLoad, cbAfterSuccess);
						} else {
							$(modal).modal('hide');
							if (cbAfterSuccess) { cbAfterSuccess(modal); }
						}
					},
					error: function(xhr, ajaxOptions, thrownError) {
					}
				});
			});
		}

		$(document).on('click', '.panel-heading span.clickable', function (e) {
		    var $this = $(this);
		    if (!$this.hasClass('panel-collapsed')) {
		        $this.parents('.panel').find('.panel-body').slideUp();
		        $this.addClass('panel-collapsed');
		        $this.find('i').removeClass('glyphicon-minus').addClass('glyphicon-plus');
		    } else {
		        $this.parents('.panel').find('.panel-body').slideDown();
		        $this.removeClass('panel-collapsed');
		        $this.find('i').removeClass('glyphicon-plus').addClass('glyphicon-minus');
		    }
		});
		$(document).on('click', '.panel div.clickable', function (e) {
		    var $this = $(this);
		    if (!$this.hasClass('panel-collapsed')) {
		        $this.parents('.panel').find('.panel-body').slideUp();
		        $this.addClass('panel-collapsed');
		        $this.find('i').removeClass('glyphicon-minus').addClass('glyphicon-plus');
		    } else {
		        $this.parents('.panel').find('.panel-body').slideDown();
		        $this.removeClass('panel-collapsed');
		        $this.find('i').removeClass('glyphicon-plus').addClass('glyphicon-minus');
		    }
		});
		$(document).ready(function () {
		    $('.panel-heading span.clickable').click();
		    $('.panel div.clickable').click();
		});
	</script>
{% endblock %}

{% block main %}
	
<div class="container">
<div class="col-md-12">
	<div class="card row p-4">
		<h4>General Information</h4>
		<table class="table table-sm table-condensed small my-4">
			<thead>
				<tr>
					<th>Order Number</th>
					<th>Order Date</th>
					<th>Vendor</th>
					<th>Agent</th>
					<th>BHP Allocation</th>
					<th>Invoice Status</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>{{order_number}}</td>
					<td>{{result.order_date}}</td>
					<td>{{justification_obj.selected_vendor.name}}</td>
					<td>{{result.agent|capfirst}}</td>
					<td>
						{% for allocation in prf_obj.allocation_set.all %}
	            			{{allocation.bhp_allocation.name}}({{allocation.percentage}}%), 
	            		{% endfor %}
					</td>
					<td>Not Paid</td>
				</tr>
			</tbody>
		</table>
	</div>
</div>
<div class="col-md-8">
	<div class="card row my-4 p-4">
		<div class="row" id="report-controller">
			<div class="col-sm-12">
				<div class="d-inline-block">
					<a class="btn btn-info btn-sm" id="download" href="{{result.file.url}}" download="{{result.file.url}}">
						<i class="fa fa-download" aria-hidden="true"></i> Download
					</a>
					<button type="button" class="btn btn-info btn-sm" id="email" data-toggle="modal" data-target="#emailModal">
						<i class="fa fa-envelope" aria-hidden="true"></i> Email
					</button>
					<a class="btn btn-info btn-sm" id="print">
						<i class="fa fa-print" aria-hidden="true"></i> Print
					</a>
				</div>
			</div>
		</div>
		<hr />
		<div class="row" id="reports">
			{% if pdf_images_bytes %}
				{% for pdf_image_bytes in pdf_images_bytes %}
					<div class="report">
						<img src="data:image/png;base64,{{pdf_image_bytes}}" width='650px' height='950px'></img>
					</div>
				{% endfor %}
			{% endif %}
		</div>
	</div>
	
	<!-- Email Modal -->
	<div id="emailModal" class="modal fade" role="dialog">
	  	<div class="modal-dialog">
	
	    <!-- content-->
	    <div class="modal-content">
	    	<div class="modal-header">
	            <button type="button" class="close" data-dismiss="modal">&times;</button>
	        </div>
	        <form action="{% url email_report_url %}"  method="post" id="email-form">
				<div class="modal-body">
					{% csrf_token %}
		            <div class="form-group col-md-12">
						<input name="sender_email" type="email" class="form-control" value="{{result.company.address.email}}" placeholder="From" required />
		            </div>
		            <div class="form-group col-md-12">
						<input name="recipient_email" type="email" class="form-control" value="" placeholder="To" required />
		            </div>
		            <div class="form-group col-md-12">
						<input name="subject" type="text" class="form-control" value="Purchase Order #{{order_number}}" placeholder="Subject" required />
		            </div>
		            <div class="form-group col-md-12">
						<textarea name="message" type="textarea" class="form-control" placeholder="Message" required></textarea>
		            </div>
		            <div class="form-group col-md-12">
		            	<i class="fa fa-paperclip" aria-hidden="true"></i> <a href="{{result.file.url}}">{{result.file.name}}</a>
		            </div>
	            	<div class="clearfix"></div>
	        	</div>
	        	<div class="modal-footer">
	            	<input type="submit" class="btn btn-success" id="email-button" value="Email" />
	            	<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	        	</div>
	        </form>
	   </div>
	 </div>
	</div>
	</div>
	<!-- Dash board panels -->
	<div class="col-md-4">
		<!-- Begin authorization panel -->
		 <div class="row p-4">
            <div class="panel panel-info">
                <div class="panel-heading clickable">
                    <h3 class="panel-title">Authorization</h3>
                    <span class="pull-right "><i class="glyphicon glyphicon-minus"></i></span>
                </div>
                <div class="panel-body">
                	<ul class="list-group">
                		<li class="list-group-item">
                			Authorization 1: <a href="">Request</a>
                		</li>
                		<li class="list-group-item">
                			Authorization 2: <a href="">Request</a>
                		</li>
                	</ul>
                </div>
            </div>
    	</div>
    	<!-- End authorization panel -->
		<!-- Begin other document links -->
		<div class="row p-4">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <span class="glyphicon glyphicon-list"></span> Other Document Links
                    <div class="pull-right action-buttons">
                        <div class="btn-group pull-right">
                            <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
                                <span class="glyphicon glyphicon-cog" style="margin-right: 0px;"></span>
                            </button>
                            <ul class="dropdown-menu slidedown">
                                <li><a href="http://www.jquery2dotnet.com"><span class="glyphicon glyphicon-download"></span> Download All</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="panel-body">
                    <ul class="list-group">
                        <li class="list-group-item">
                            <div class="checkbox">
                                <input type="checkbox" id="checkbox" />
                                <label for="checkbox">
                                    List group item heading
                                </label>
                            </div>
                            <div class="pull-right action-buttons">
                                <a href="http://www.jquery2dotnet.com"><span class="glyphicon glyphicon-download"></span></a>
                            </div>
                        </li>           
                    </ul>
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div>
                            <h6>
                                Total Count <span class="label label-info">25</span></h6>
                        </div>
                    </div>
                </div>
	        </div>
	    </div>
	   	<!-- End other document links -->
	</div>
</div>


{% endblock main %}
